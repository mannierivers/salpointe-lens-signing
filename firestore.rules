rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    match /appointments/{userId} {
      // 1. Anyone logged in can read the basic list
      allow read: if request.auth != null;

      // 2. Students can create/update their own record with a Salpointe email
      allow create, update: if request.auth != null 
        && request.auth.uid == userId 
        && request.auth.token.email.matches('.*@salpointe\\.org$');

      // 3. ADMIN OVERRIDE: Michaela and Mr. Rivers can do ANYTHING (read, write, delete)
      // This ensures the Admin Dashboard never hits a "Permission Denied" error
      allow write, delete: if request.auth != null && (
        request.auth.token.email == '26mpost@salpointe.org' || 
        request.auth.token.email == 'erivers@salpointe.org'
      );
    }
  }
}